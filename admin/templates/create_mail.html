<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Mailbox - Admin Panel</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        :root {
            --dark: #0a0a0a;
            --darker: #000000;
            --light: #f0f0f0;
            --gray: #1a1a1a;
            --light-gray: #2d2d2d;
            --border: #333333;
            --hover: #3a3a3a;
            --primary: #4a90e2;
        }
        
        body {
            background-color: var(--darker);
            color: var(--light);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .sidebar {
            background: var(--dark);
            border-right: 1px solid var(--border);
            min-height: 100vh;
            padding: 20px 0;
        }
        
        .sidebar .nav-link {
            color: #aaa;
            margin: 5px 15px;
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            background: var(--light-gray);
            color: var(--light);
        }
        
        .sidebar .nav-link i {
            margin-right: 10px;
        }
        
        .main-content {
            padding: 20px;
        }
        
        .card {
            background: var(--gray);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .card-header {
            background: var(--light-gray);
            border-bottom: 1px solid var(--border);
            font-weight: 600;
        }
        
        .form-control, .form-select {
            background: var(--light-gray);
            border: 1px solid var(--border);
            color: var(--light);
        }
        
        .form-control:focus, .form-select:focus {
            background: var(--light-gray);
            border-color: var(--primary);
            box-shadow: 0 0 0 0.25rem rgba(74, 144, 226, 0.25);
            color: var(--light);
        }
        
        .btn-primary {
            background-color: var(--primary);
            border: none;
        }
        
        .btn-primary:hover {
            background-color: #3a7bc8;
        }
        
        .btn-success {
            background-color: #50c878;
            border: none;
        }
        
        .btn-info {
            background-color: #17a2b8;
            border: none;
        }
        
        .navbar {
            background: var(--dark);
            border-bottom: 1px solid var(--border);
        }
        
        .user-info {
            display: flex;
            align-items: center;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
        }
        
        .password-strength {
            height: 5px;
            background: #333;
            border-radius: 3px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .strength-meter {
            height: 100%;
            width: 0%;
            transition: width 0.3s, background 0.3s;
        }
        
        .weak { background: #ff4d4d; width: 33%; }
        .medium { background: #ffcc00; width: 66%; }
        .strong { background: #4caf50; width: 100%; }
        
        .password-requirements {
            background: rgba(74, 144, 226, 0.1);
            border: 1px solid rgba(74, 144, 226, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
        }
        
        .requirement {
            font-size: 0.9rem;
            margin: 5px 0;
        }
        
        .requirement.met {
            color: #50c878;
        }
        
        .requirement.unmet {
            color: #ff6b6b;
        }
        
        .auto-gen-section {
            background: rgba(23, 162, 184, 0.1);
            border: 1px solid rgba(23, 162, 184, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
        }
        
        .generated-password {
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            letter-spacing: 1px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            margin: 10px 0;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-lg-2 d-none d-lg-block sidebar">
                <div class="text-center mb-4">
                    <h3 class="mt-3"><i class="bi bi-envelope-heart"></i> MailAdmin</h3>
                </div>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('dashboard') }}">
                            <i class="bi bi-speedometer2"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('list_mailboxes') }}">
                            <i class="bi bi-envelope"></i> Mailboxes
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="{{ url_for('create') }}">
                            <i class="bi bi-plus-circle"></i> Create Mailbox
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('categories') }}">
                            <i class="bi bi-tags"></i> Categories
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('email_platforms') }}">
                            <i class="bi bi-grid-3x3-gap"></i> Email Platforms
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="bi bi-gear"></i> Settings
                        </a>
                    </li>
                </ul>
            </div>
            
            <!-- Main Content -->
            <div class="col-lg-10 col-12 main-content">
                <!-- Top Navbar for Mobile -->
                <nav class="navbar navbar-expand-lg d-lg-none">
                    <div class="container-fluid">
                        <a class="navbar-brand" href="#"><i class="bi bi-envelope-heart"></i> MailAdmin</a>
                        <div class="user-info">
                            <div class="dropdown">
                                <a class="dropdown-toggle text-decoration-none text-light" href="#" role="button" data-bs-toggle="dropdown">
                                    <div class="user-avatar">
                                        <i class="bi bi-person"></i>
                                    </div>
                                </a>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="{{ url_for('dashboard') }}"><i class="bi bi-speedometer2"></i> Dashboard</a></li>
                                    <li><a class="dropdown-item" href="{{ url_for('list_mailboxes') }}"><i class="bi bi-envelope"></i> Mailboxes</a></li>
                                    <li><a class="dropdown-item" href="{{ url_for('create') }}"><i class="bi bi-plus-circle"></i> Create Mailbox</a></li>
                                    <li><a class="dropdown-item" href="{{ url_for('categories') }}"><i class="bi bi-tags"></i> Categories</a></li>
                                    <li><a class="dropdown-item" href="{{ url_for('email_platforms') }}"><i class="bi bi-grid-3x3-gap"></i> Email Platforms</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="{{ url_for('logout') }}"><i class="bi bi-box-arrow-right"></i> Logout</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </nav>
                
                <!-- Desktop Top Bar -->
                <div class="d-none d-lg-flex justify-content-between align-items-center mb-4">
                    <h1>Create Mailbox</h1>
                    <div class="user-info">
                        <div class="dropdown">
                            <a class="dropdown-toggle text-decoration-none text-light" href="#" role="button" data-bs-toggle="dropdown">
                                <div class="user-avatar">
                                    <i class="bi bi-person"></i>
                                </div>
                                <span class="ms-2">{{ session.admin_username }}</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="{{ url_for('dashboard') }}"><i class="bi bi-speedometer2"></i> Dashboard</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('list_mailboxes') }}"><i class="bi bi-envelope"></i> Mailboxes</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('create') }}"><i class="bi bi-plus-circle"></i> Create Mailbox</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('categories') }}"><i class="bi bi-tags"></i> Categories</a></li>
                                <li><a class="dropdown-item" href="{{ url_for('email_platforms') }}"><i class="bi bi-grid-3x3-gap"></i> Email Platforms</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="{{ url_for('logout') }}"><i class="bi bi-box-arrow-right"></i> Logout</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <i class="bi bi-envelope-plus"></i> New Mailbox Details
                    </div>
                    <div class="card-body">
                        {% with messages = get_flashed_messages(with_categories=true) %}
                          {% if messages %}
                            {% for category, message in messages %}
                              <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                                  <i class="bi bi-{% if category == 'success' %}check-circle{% elif category == 'danger' %}exclamation-triangle{% else %}info{% endif %}-fill"></i>
                                  {{ message }}
                                  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                              </div>
                            {% endfor %}
                          {% endif %}
                        {% endwith %}
                        
                        <form method="POST" id="createMailboxForm">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Username *</label>
                                    <div class="input-group">
                                        <span class="input-group-text">@</span>
                                        <input type="text" name="local_part" class="form-control" placeholder="john.doe" required>
                                    </div>
                                    <div class="form-text">The part before the @ symbol in the email address</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Domain *</label>
                                    <select name="domain" class="form-select" required>
                                        {% if domains %}
                                            {% for domain in domains %}
                                            <option value="{{ domain }}">{{ domain }}</option>
                                            {% endfor %}
                                        {% else %}
                                            <option value="bltnm.store">bltnm.store</option>
                                        {% endif %}
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Full Name *</label>
                                <input type="text" name="name" class="form-control" placeholder="John Doe" required>
                                <div class="form-text">The full name of the mailbox owner</div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Password *</label>
                                <div class="input-group">
                                    <input type="password" name="password" id="password" class="form-control" placeholder="Secure password" required minlength="8">
                                    <button class="btn btn-info" type="button" id="generatePassword">
                                        <i class="bi bi-key"></i> Generate
                                    </button>
                                </div>
                                <div class="password-strength">
                                    <div class="strength-meter" id="strengthMeter"></div>
                                </div>
                                <div class="auto-gen-section" id="autoGenSection" style="display: none;">
                                    <h6>Auto-Generated Password:</h6>
                                    <div class="generated-password" id="generatedPassword"></div>
                                    <button type="button" class="btn btn-sm btn-outline-primary" id="useGenerated">
                                        <i class="bi bi-check-circle"></i> Use This Password
                                    </button>
                                </div>
                                <div class="password-requirements">
                                    <h6>Password Requirements:</h6>
                                    <div class="requirement" id="req-length">• At least 8 characters</div>
                                    <div class="requirement" id="req-upper">• At least one uppercase letter (A-Z)</div>
                                    <div class="requirement" id="req-lower">• At least one lowercase letter (a-z)</div>
                                    <div class="requirement" id="req-number">• At least one number (0-9)</div>
                                    <div class="requirement" id="req-special">• At least one special character (!@#$%^&*)</div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Confirm Password *</label>
                                <input type="password" name="confirm_password" id="confirmPassword" class="form-control" placeholder="Confirm password" required>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Category</label>
                                <select name="category" class="form-select">
                                    <option value="General">General</option>
                                    {% for category in categories %}
                                    <option value="{{ category.name }}">{{ category.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Quota (MB)</label>
                                <input type="number" name="quota" class="form-control" value="1024" min="100" max="10240">
                                <div class="form-text">Storage quota for this mailbox (100MB to 10240MB)</div>
                            </div>
                            
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <a href="{{ url_for('list_mailboxes') }}" class="btn btn-secondary">
                                    <i class="bi bi-arrow-left"></i> Cancel
                                </a>
                                <button type="submit" class="btn btn-success">
                                    <i class="bi bi-check-circle"></i> Create Mailbox
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Generate a strong password
        function generatePassword() {
            const length = 16;
            const charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+-=[]{}|;:,.<>?";
            let password = "";
            for (let i = 0; i < length; i++) {
                const randomIndex = Math.floor(Math.random() * charset.length);
                password += charset[randomIndex];
            }
            return password;
        }
        
        // Password strength indicator and requirements checker
        document.getElementById('password').addEventListener('input', function() {
            const password = this.value;
            const strengthMeter = document.getElementById('strengthMeter');
            
            // Update strength meter
            let strength = 0;
            if (password.length >= 8) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;
            
            strengthMeter.className = 'strength-meter';
            if (strength <= 1) {
                strengthMeter.classList.add('weak');
            } else if (strength <= 3) {
                strengthMeter.classList.add('medium');
            } else {
                strengthMeter.classList.add('strong');
            }
            
            // Update requirement indicators
            document.getElementById('req-length').className = password.length >= 8 ? 'requirement met' : 'requirement unmet';
            document.getElementById('req-upper').className = /[A-Z]/.test(password) ? 'requirement met' : 'requirement unmet';
            document.getElementById('req-lower').className = /[a-z]/.test(password) ? 'requirement met' : 'requirement unmet';
            document.getElementById('req-number').className = /[0-9]/.test(password) ? 'requirement met' : 'requirement unmet';
            document.getElementById('req-special').className = /[^A-Za-z0-9]/.test(password) ? 'requirement met' : 'requirement unmet';
        });
        
        // Auto-generate password
        document.getElementById('generatePassword').addEventListener('click', function() {
            const newPassword = generatePassword();
            document.getElementById('generatedPassword').textContent = newPassword;
            document.getElementById('autoGenSection').style.display = 'block';
        });
        
        // Use generated password
        document.getElementById('useGenerated').addEventListener('click', function() {
            const generatedPassword = document.getElementById('generatedPassword').textContent;
            document.getElementById('password').value = generatedPassword;
            document.getElementById('confirmPassword').value = generatedPassword;
            document.getElementById('autoGenSection').style.display = 'none';
            
            // Trigger input event to update strength meter
            const event = new Event('input', { bubbles: true });
            document.getElementById('password').dispatchEvent(event);
        });
        
        // Form validation
        document.getElementById('createMailboxForm').addEventListener('submit', function(e) {
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (password !== confirmPassword) {
                e.preventDefault();
                alert('Passwords do not match!');
                return false;
            }
        });
    </script>
</body>
</html>